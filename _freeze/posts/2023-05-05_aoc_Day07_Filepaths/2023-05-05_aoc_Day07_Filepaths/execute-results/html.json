{
  "hash": "076dd65888474d46d716e84aa71ca5ba",
  "result": {
    "markdown": "---\ntitle: \"Advent of Code Day 7: Tracking file paths\"\ndate: 2023-05-05\n---\n\n::: {.cell}\n\n:::\n\n\nTrack the directory paths and file sizes from a series of OS commands\n\n## Introduction\n\nThis post explains my solution to the [Advent of Code](http://adventofcode.com/) problem from Day 7. The communication device that you need to communicate with the other elves has now run out of file space.  You must determine the file size of each directory and then identify the directory to delete in order to meet the proper operating requirements.\n\n## Loading the input file\n\nThe input file consists of 964 lines of operating system commands and output.  Simply using ```readLines``` function from base R does a fine job of reading each command as a string in a string vector containing all of the commands.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(stringr)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nfilepath <- here::here(\"./posts/data/aoc/day07_input.txt\")\ncommands <- readLines(filepath)\n```\n:::\n\nThe input file structure looks similar to what is shown below.  The OS commands begin with a \"$\" with ```cd``` and ```ls``` commands for change directory and list files respectively.  After the ```ls``` command, the sub-directories and files are listed for the current directory with directories starting with ```dir``` and files listing the file size followed by the file name.\n\n```\n$ cd /\n$ ls\ndir a\n14848514 b.txt\n8504156 c.dat\ndir d\n$ cd a\n$ ls\ndir e\n29116 f\n2557 g\n62596 h.lst\n$ cd e\n$ ls\n584 i\n$ cd ..\n$ cd ..\n$ cd d\n$ ls\n4060174 j\n8033020 d.log\n5626152 d.ext\n7214296 k\n```\n\n## Part One: Directory sizes\n\nThe first goal is to determine the size of each directory from the commands and output listed in the input file.  The directory paths can be tracked from the commands containing ```cd```.  There are three types of ```cd``` commands: 1) ```$ cd \\``` to go back to the root directory, 2) ```$ cd ..``` to go back (up) one directory and 3) ```$ cd```*[dir name]*.  The ```ls``` commands can be ignored as the subsequent output can be handled directly.  The ```dir``` output can also be ignored since the directories are tracked with the ```cd``` commands.  The file size and name output must be saved to their corresponding directory path.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npath <- \"root\"\n# Initialize tibble to store the file info\nfiledf <- tibble(dirpath = character(), filesize = character(), filename = character())\n\nfor (command in commands) {\n  # Split each command into a string vector\n  comm_spl <- str_split(command, pattern = \" \", simplify = TRUE)\n  \n  if (comm_spl[[1]] == \"$\") {\n    \n    if (comm_spl[[2]] == \"ls\") {\n      # do nothing\n    } else {\n      # Otherwise it is a cd command so update the path\n      if (comm_spl[[3]] == \"/\") {\n        path <- path[1]\n      } else if (comm_spl[[3]] == \"..\") {\n        path <- path[1:length(path)-1]\n      } else {\n        path <- c(path, comm_spl[[3]])\n      }\n    }\n  } else if (comm_spl[[1]] == \"dir\") {\n    # do nothing\n  } else  {\n    # Otherwise it is a number and a file name\n    # For loop to save the file size for current directory and all parent directories\n    for (i in 1:length(path)) {\n      filedf <- bind_rows(filedf, tibble(dirpath = paste(path[1:i], collapse = \"/\"), filesize = comm_spl[[1]], filename = comm_spl[[2]]))\n    }\n  }\n}\n```\n:::\n\n\nThe ```filedf``` tibble now contains a row for each file in each directory (including files in the sub-directories of the directory).  The total directory size can now be determined by grouping on the directory path and using the ```dplyr``` summarize function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndirsizes <- filedf |>\n  mutate(filesize = as.numeric(filesize)) |>\n  group_by(dirpath) |> \n  summarize(total = sum(filesize), .groups = \"drop\")\n\nhead(dirsizes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n  dirpath                                   total\n  <chr>                                     <dbl>\n1 root                                   42805968\n2 root/cmwrq                             10449487\n3 root/cmwrq/dtbzzl                       2919892\n4 root/cmwrq/dtbzzl/wwpnn                 2877389\n5 root/cmwrq/dtbzzl/wwpnn/lwqgsbg         1927095\n6 root/cmwrq/dtbzzl/wwpnn/lwqgsbg/dtbzzl   252091\n```\n:::\n:::\n\n\nNow, we need to find the total size for all directories with size less than or equal to 100000.  This total is found rather easily by filtering and summarizing using the corresponding functions from the ```dplyr``` package as shown below. \n\n::: {.cell}\n\n```{.r .cell-code}\ndirsizes |>\n  filter(total <= 100000) |>\n  summarize(sum(total))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  `sum(total)`\n         <dbl>\n1       919137\n```\n:::\n:::\n\n## Part Two: Select a directory to delete\n\nThe communication device file system has a total capacity of 70000000.  In order to run an update, we need at least 30000000 free space on the device.  As shown from Part One above, the root directory size is 42805968.  We need to delete a directory with a size of at least 2805968 to free up enough space.\n\n::: {.cell}\n\n```{.r .cell-code}\nmax_size <- 70000000\nfree_size <- 30000000\nunused_size <- max_size - dirsizes[[1, \"total\"]]  #max_size - root dir size\ndelete_size <- free_size - unused_size\n\ndelete_size\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2805968\n```\n:::\n:::\n\nThe directory closest to this size but not under was found from the ```dirsizes``` tibble.  The difference between the dir size and the delete size is determined for each directory, the differences below 0 are filtered out and the tibble is arranged so the least difference is at the top.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndirsizes |>\n  mutate(distance = total - delete_size) |>\n  filter(distance >= 0) |>\n  arrange(distance) |>\n  slice(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  dirpath                   total distance\n  <chr>                     <dbl>    <dbl>\n1 root/cmwrq/dtbzzl/wwpnn 2877389    71421\n```\n:::\n:::\n\nThe question for Part Two was to enter the total size for this directory.\n\n## Summary\n\nThe Day 7 puzzle was solved easily once the means for tracking the filepaths was found.  Storing all of the files in a tibble made it straightforward to find the answers using ```dplyr``` functions to group and summarize the directories appropriately.\n\n:::{.callout-tip collapse=\"true\"}\n## Expand for Session Info\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.2 (2022-10-31 ucrt)\n os       Windows 10 x64 (build 19045)\n system   x86_64, mingw32\n ui       RTerm\n language (EN)\n collate  English_United States.utf8\n ctype    English_United States.utf8\n tz       America/Chicago\n date     2023-05-08\n pandoc   2.19.2 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n quarto   1.2.335 @ C:\\\\PROGRA~1\\\\RStudio\\\\RESOUR~1\\\\app\\\\bin\\\\quarto\\\\bin\\\\quarto.exe\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package     * version date (UTC) lib source\n P dplyr       * 1.0.10  2022-09-01 [?] CRAN (R 4.2.2)\n P sessioninfo * 1.2.2   2021-12-06 [?] CRAN (R 4.2.1)\n P stringr     * 1.5.0   2022-12-02 [?] CRAN (R 4.2.2)\n\n [1] C:/Users/David Zoller/AppData/Local/Temp/RtmpqwuFJX/renv-library-27cc5ad71235\n [2] C:/Users/David Zoller/Documents/datadavidz.github.io/renv/library/R-4.2/x86_64-w64-mingw32\n [3] C:/Users/David Zoller/AppData/Local/Temp/RtmpqwuFJX/renv-system-library\n\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}