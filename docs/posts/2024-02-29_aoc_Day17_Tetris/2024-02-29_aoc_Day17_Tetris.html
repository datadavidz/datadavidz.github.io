<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="datadavidz">
<meta name="dcterms.date" content="2024-02-29">

<title>[datadavidz] - Advent of Code Day 17: Coordinates as Complex Numbers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #000;
      }
</style>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">[datadavidz]</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/datadavidz" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/datadavidz" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Advent of Code Day 17: Coordinates as Complex Numbers</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>datadavidz </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 29, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Simulating falling rocks with different shapes (similar to the game Tetris)</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This post explains my solution to the <a href="http://adventofcode.com/">Advent of Code</a> problem from Day 17. You arrive in a tall, narrow cavern with different shape rocks falling down. If you can’t figure out which rocks will drop next, you will be crushed. The rocks have the following shapes (with ‘#’ meaning rock and a ‘.’ meaning a space:</p>
<pre><code>####

.#.
###
.#.

..#
..#
###

#
#
#
#

##
##</code></pre>
<p>The rocks fall in the order as shown from top to bottom. After the fifth rock has fallen, the sequence starts again in the same order. The rocks are pushed left or right by jets of gas coming from the cavern walls. The jets follow a sequence as shown below.</p>
<pre><code>&gt;&gt;&gt;&lt;&lt;&gt;&lt;&gt;&gt;&lt;&lt;&lt;&gt;&gt;&lt;&gt;&gt;&gt;&lt;&lt;&lt;&gt;&gt;&gt;&lt;&lt;&lt;&gt;&lt;&lt;&lt;&gt;&gt;&lt;&gt;&gt;&lt;&lt;&gt;&gt;</code></pre>
<p>A ‘&gt;’ means the gas jet pushes the rock to the right and a ‘&lt;’ means the gas jet pushes the rock to the right. Once the end is reached, the sequence starts over again starting at the beginning. The cavern is exactly 7 units wide. A rock appears so that its left edge is two units away from the left cavern wall and 3 units from the highest rock (or the floor if no rocks have dropped). After the rock appears, it alternates between being pushed by a gas jet and then falling one unit down. If the rock is blocked from moving left or right due to another rock or the cavern wall, the rock stays at its current location. If the rock is blocked from moving down due to another rock or the cavern floor, the rock becomes fixed at its current location and part of a solid rock structure in the cavern. Once the rock becomes fixed, a new rock appears at the top of the cavern.</p>
<p>The goal is to determine the height of the solid rock structure in the cavern after a specific number of rocks have fallen. In Part One, you need to determine the height after 2022 rocks have fallen. In Part Two, you need to determine the height after one trillion rocks have fallen.</p>
</section>
<section id="loading-the-input-file" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-input-file">Loading the input file</h2>
<p>The input file contains only the jet sequence which is a single string made up of ‘&gt;’ and ‘&lt;’ characters. The input file is much longer than in the example shown above. The string is split into an array of single characters using the <code>str_split_1</code> function from the <code>stringr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>filepath <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"./posts/data/aoc/day17_input.txt"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#filepath &lt;- here::here("./posts/data/aoc/day17_test.txt")</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>input_jet <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(filepath, <span class="at">skip_empty_rows =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>input_jet <span class="ot">&lt;-</span> <span class="fu">str_trim</span>(input_jet) <span class="sc">|&gt;</span> <span class="fu">str_split_1</span>(<span class="st">""</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(input_jet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10091</code></pre>
</div>
</div>
<p>At first, I tried representing the rocks using the characters as shown however this became overly complex programmatically. The better way to represent the rocks is numerically according to the x and y coordinates. A further optimization can be realized if you use complex numbers where the real part represents the x coordinate and the imaginary part represents the y coordinate. I learned this from the Day 17 solution posted by <a href="https://github.com/hyper-neutrino/advent-of-code">hyper neutrino</a>. In fact, much of the solution presented below is based upon his Python implementation. The five types of rocks represented as complex numbers are shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rocks <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>, 1i, <span class="dv">1</span><span class="sc">+</span>1i, <span class="dv">2</span><span class="sc">+</span>1i, <span class="dv">1</span><span class="sc">+</span>2i),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span><span class="sc">+</span>1i, <span class="dv">2</span><span class="sc">+</span>2i),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, 1i, 2i, 3i),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, 1i, <span class="dv">1</span><span class="sc">+</span>1i)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The jet sequence is also best represented numerically which can be accomplished with a single line of code. A ‘&gt;’ or shift to the right is changed to a 1 and a ‘&lt;’ or shift to the left is change to a -1. The <code>map_int</code> function from the <code>purrr</code> package is used to transform the character array into a numerical list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>jets <span class="ot">&lt;-</span> <span class="fu">map_int</span>(input_jet, \(x) <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">"&gt;"</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-one" class="level2">
<h2 class="anchored" data-anchor-id="part-one">Part One</h2>
<p>Now, we need to determine the height of the solid rock structure after 2022 rocks have dropped into the cavern. The cavern floor and first rock are initialized. The rock position is then first updated based on the gas jet and then updated based on dropping one unit down. The set of map functions from the purrr package are used extensively to update the rock coordinates in a concise way. The list containing the solid structure is occasionally updated to just the top 200 coordinates in order to optimize the speed of execution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the solid as the cavern floor</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>solid <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>, \(x) x<span class="sc">-</span>1i)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>rc <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#rock count</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>ri <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#rock index</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>lim <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co">#limit the amount of data stored for the solid</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># update position of the first rock</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>rock <span class="ot">&lt;-</span> <span class="fu">map</span>(rocks[[ri<span class="sc">+</span><span class="dv">1</span>]], \(x) x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> (height <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> 1i)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (rc <span class="sc">&lt;</span> <span class="dv">2022</span>) {</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (jet <span class="cf">in</span> jets) {</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update the rock position due to the gas jet</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    moved <span class="ot">&lt;-</span> <span class="fu">map</span>(rock, \(x) x <span class="sc">+</span> jet)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    blocked <span class="ot">&lt;-</span> <span class="fu">any</span>(moved <span class="sc">%in%</span> solid)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">map_lgl</span>(moved, \(x) (<span class="fu">Re</span>(x) <span class="sc">&lt;</span> <span class="dv">7</span>) <span class="sc">&amp;</span> (<span class="fu">Re</span>(x) <span class="sc">&gt;=</span> <span class="dv">0</span>))) <span class="sc">&amp;</span> <span class="sc">!</span>blocked) {</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      rock <span class="ot">&lt;-</span> moved</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update the rock position to drop one unit</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    moved <span class="ot">&lt;-</span> <span class="fu">map</span>(rock, \(x) x <span class="sc">-</span> 1i)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if the rock is blocked from moving down then it becomes part of the solid</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(moved <span class="sc">%in%</span> solid)) {</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      solid <span class="ot">&lt;-</span> <span class="fu">c</span>(solid, rock[<span class="sc">!</span>(rock <span class="sc">%in%</span> solid)])</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      rc <span class="ot">&lt;-</span> rc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      height <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">map_vec</span>(solid, \(x) <span class="fu">Im</span>(x))) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rc <span class="sc">&gt;=</span> <span class="dv">2022</span>) <span class="cf">break</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      ri <span class="ot">&lt;-</span> (ri <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%%</span> <span class="dv">5</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>      rock <span class="ot">&lt;-</span> <span class="fu">map</span>(rocks[[ri<span class="sc">+</span><span class="dv">1</span>]], \(x) x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> (height <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> 1i)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      <span class="co"># if rock is not blocked then update the position</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>      rock <span class="ot">&lt;-</span> moved</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep the solid list from taking up too much memory</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(solid) <span class="sc">&gt;</span> lim) solid <span class="ot">&lt;-</span> solid[(<span class="fu">length</span>(solid)<span class="sc">-</span>(lim<span class="sc">+</span><span class="dv">1</span>))<span class="sc">:</span><span class="fu">length</span>(solid)]</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>height</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3117</code></pre>
</div>
</div>
<p>After 2022 rocks have fallen, the height of the solid rock structure is 3117 units.</p>
</section>
<section id="part-two" class="level2">
<h2 class="anchored" data-anchor-id="part-two">Part Two</h2>
<p>Apparently, the elephants are not impressed by the simulation of 2022 rocks and want to see the results after dropping a trillion rocks. Of course, executing the same loop for a trillion rocks would take much too long so we need to find a shortcut. The shortcut is to look for a repeating sequence as the rocks are dropped. To find the start of the repeating sequence, we are looking for three conditions to be met: the jet index, the rock index and the top of the solid rock structure are the same values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>solid <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>, \(x) x<span class="sc">-</span>1i)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>numblock <span class="ot">&lt;-</span> <span class="fl">1e12</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># store the rock count and height at each jet index, rock index and top of solid</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>seen <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the top of the solid rock structure</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>summarize_solid <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  o <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">7</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (x <span class="cf">in</span> solid) {</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">Re</span>(x)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">Im</span>(x)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    o[r<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">max</span>(o[r<span class="sc">+</span><span class="dv">1</span>], i)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  top <span class="ot">&lt;-</span> <span class="fu">max</span>(o)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">map_int</span>(o, \(x) x <span class="sc">-</span> top))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>rc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>ri <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>lim <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>rock <span class="ot">&lt;-</span> <span class="fu">map</span>(rocks[[ri<span class="sc">+</span><span class="dv">1</span>]], \(x) x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> (height <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> 1i)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (rc <span class="sc">&lt;</span> numblock) {</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ji <span class="cf">in</span> <span class="fu">seq_along</span>(jets)) {</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    jet <span class="ot">&lt;-</span> jets[ji]</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    moved <span class="ot">&lt;-</span> <span class="fu">map</span>(rock, \(x) x <span class="sc">+</span> jet)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    blocked <span class="ot">&lt;-</span> <span class="fu">any</span>(moved <span class="sc">%in%</span> solid)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">map_lgl</span>(moved, \(x) (<span class="fu">Re</span>(x) <span class="sc">&lt;</span> <span class="dv">7</span>) <span class="sc">&amp;</span> (<span class="fu">Re</span>(x) <span class="sc">&gt;=</span> <span class="dv">0</span>))) <span class="sc">&amp;</span> <span class="sc">!</span>blocked) {</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      rock <span class="ot">&lt;-</span> moved</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    moved <span class="ot">&lt;-</span> <span class="fu">map</span>(rock, \(x) x <span class="sc">-</span> 1i)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(moved <span class="sc">%in%</span> solid)) {</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      solid <span class="ot">&lt;-</span> <span class="fu">c</span>(solid, rock[<span class="sc">!</span>(rock <span class="sc">%in%</span> solid)])</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      rc <span class="ot">&lt;-</span> rc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>      height <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">map_vec</span>(solid, \(x) <span class="fu">Im</span>(x))) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rc <span class="sc">&gt;=</span> numblock) <span class="cf">break</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      ri <span class="ot">&lt;-</span> (ri <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%%</span> <span class="dv">5</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>      rock <span class="ot">&lt;-</span> <span class="fu">map</span>(rocks[[ri<span class="sc">+</span><span class="dv">1</span>]], \(x) x <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> (height <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> 1i)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># create a key with the jet index, rock index and top of the solid</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>      key <span class="ot">&lt;-</span> <span class="fu">paste0</span>(ji, ri, <span class="fu">paste</span>(<span class="fu">summarize_solid</span>(), <span class="at">collapse =</span> <span class="st">''</span>))</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>      <span class="co"># if the key has been seen before, calculate the offset</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (key <span class="sc">%in%</span> <span class="fu">names</span>(seen)) {</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>        lrc <span class="ot">&lt;-</span> seen[[key]][<span class="dv">1</span>] <span class="co">#last rock count</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        lh <span class="ot">&lt;-</span> seen[[key]][<span class="dv">2</span>]  <span class="co">#last height</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        rem <span class="ot">&lt;-</span> numblock <span class="sc">-</span> rc  <span class="co">#remainder of rocks left</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        rep <span class="ot">&lt;-</span> <span class="fu">floor</span>(rem <span class="sc">/</span> (rc <span class="sc">-</span> lrc)) <span class="co"># number of repetitions of the same sequence</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        offset <span class="ot">&lt;-</span> rep <span class="sc">*</span> (height <span class="sc">-</span> lh)  <span class="co"># amount to add to the height due to repeats</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        rc <span class="ot">&lt;-</span> rc <span class="sc">+</span> (rep <span class="sc">*</span> (rc <span class="sc">-</span> lrc))  <span class="co"># update the rock count</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        seen <span class="ot">&lt;-</span> <span class="fu">list</span>()                 <span class="co"># clear the seen list</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>      seen[[key]] <span class="ot">&lt;-</span> <span class="fu">c</span>(rc, height)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>      rock <span class="ot">&lt;-</span> moved</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(solid) <span class="sc">&gt;</span> lim) solid <span class="ot">&lt;-</span> solid[(<span class="fu">length</span>(solid)<span class="sc">-</span>(lim<span class="sc">+</span><span class="dv">1</span>))<span class="sc">:</span><span class="fu">length</span>(solid)]</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(height <span class="sc">+</span> offset, <span class="at">scientific =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1553314121019"</code></pre>
</div>
</div>
<p>Using the shortcut of finding the repeating sequence enables finding the height of 1553314121019 units for a trillion blocks in a little over a minute! The rocks are iterated until the repeat is found, the rock count is jumped ahead for the number of repeats that can occur without exceeding one trillion rocks and then the rocks are iterated until one trillion rocks are dropped.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>The simulation of dropping a sequence of rocks into a cavern was successfully executed in R for one trillion rocks. Some nice optimizations were implemented to have concise code which executes relatively quickly. It helped to represent the rock coordinates as complex numbers. The map functions from the <code>purrr</code> package enabled concise code. The shortcut to find a repeating sequence using a named list in a manner analogous to a Python dictionary was the key to completing Part Two.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand for Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.2 (2023-10-31 ucrt)
 os       Windows 10 x64 (build 19045)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United States.utf8
 ctype    English_United States.utf8
 tz       America/Chicago
 date     2024-03-01
 pandoc   3.1.1 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)
 quarto   1.3.450 @ C:\\PROGRA~1\\RStudio\\RESOUR~1\\app\\bin\\quarto\\bin\\quarto.exe

─ Packages ───────────────────────────────────────────────────────────────────
 ! package     * version date (UTC) lib source
 P purrr       * 1.0.2   2023-08-10 [?] CRAN (R 4.3.2)
 P readr       * 2.1.5   2024-01-10 [?] CRAN (R 4.3.2)
 P sessioninfo * 1.2.2   2021-12-06 [?] CRAN (R 4.3.2)
 P stringr     * 1.5.1   2023-11-14 [?] CRAN (R 4.3.2)

 [1] C:/Users/David Zoller/AppData/Local/Temp/RtmpwB7kPZ/renv-use-libpath-1e2c4fb81c94
 [2] C:/Users/David Zoller/Documents/datadavidz.github.io/renv/library/R-4.3/x86_64-w64-mingw32
 [3] C:/Users/David Zoller/AppData/Local/R/cache/R/renv/sandbox/R-4.3/x86_64-w64-mingw32/7f66d5b3

 P ── Loaded and on-disk path mismatch.

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>